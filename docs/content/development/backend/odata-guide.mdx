import { CodeBlock } from '@/components/CodeBlock'

# OData Query Guide

This guide covers how to use OData queries with the Rhesis backend API. All examples in this guide have been tested and verified to work with the current implementation.

## Table of Contents

1. [Basic Concepts](#basic-concepts)
2. [Comparison Operators](#comparison-operators)
3. [String Functions](#string-functions)
4. [Navigation Properties](#navigation-properties)
5. [Logical Operators](#logical-operators)
6. [Advanced Features](#advanced-features)
7. [Complete Examples](#complete-examples)
8. [Best Practices](#best-practices)

## Basic Concepts

OData (Open Data Protocol) is a REST-based protocol for querying and updating data. In Rhesis, you can use OData filters with the `$filter` query parameter.

### URL Format

<CodeBlock filename="example.text" language="text">
{`GET /endpoint?$filter=<odata-expression>`}
</CodeBlock>

### Au<CodeBlock filename="Terminal" language="bash">
{`curl -H "Authorization: Bearer YOUR_API_KEY" "URL"`}
</CodeBlock>rl -H "Authorization: Bearer YOUR_API_KEY" "URL"
<CodeBlock filename="example.text" language="text">
{`
## Comparison O<CodeBlock filename="Terminal" language="bash">
{`# Find tests with priority = 1
GET /tests?$filter=priority eq 1

# Find behaviors with specific name
GET /behaviors?$filter=name eq 'Test Behavior'`}
</CodeBlock>e
GET /behaviors?$filter<CodeBlock filename="Terminal" language="bash">
{`# Find tests where priority is not null
GET /tests?$filter=priority ne null

# Find behaviors not named 'Test'
GET /behaviors?$filter=name ne 'Test'`}
</CodeBlock>med 'Test'
GET /behaviors?$filter=name ne 'Test'`}
</CodeBlock>
<CodeBlock filename="Terminal" language="bash">
{`# Find tests with priority > 0
GET /tests?$filter=priority gt 0`}
</CodeBlock>th priority > 0
GET /tes<CodeBlock filename="Terminal" language="bash">
{`# Find tests with priority < 5
GET /tests?$filter=priority lt 5`}
</CodeBlock>th priority < 5
GET /tests?$filter=p<CodeBlock filename="Terminal" language="bash">
{`# Find tests with priority >= 1
GET /tests?$filter=priority ge 1`}
</CodeBlock>h priority >= 1
GET /tests?$filte<CodeBlock filename="Terminal" language="bash">
{`# Find tests with priority <= 5
GET /tests?$filter=priority le 5`}
</CodeBlock>h priority <= 5
GET /tests?$filter=priority le 5
<CodeBlock filename="example.javascript" language="javascript">
{`
## String Functions

All string functions use function-st<CodeBlock filename="Terminal" language="bash">
{`# Find behaviors containing 'Test' in name
GET /behaviors?$filter=contains(name,'Test')

# Case-insensitive search
GET /behaviors?$filter=contains(tolower(name),'test')`}
</CodeBlock>behaviors?$filter=c<CodeBlock filename="Terminal" language="bash">
{`# Find behaviors starting with 'Test'
GET /behaviors?$filter=startswith(name,'Test')`}
</CodeBlock>'
GET /behaviors?<CodeBlock filename="Terminal" language="bash">
{`# Find behaviors ending with 'Behavior'
GET /behaviors?$filter=endswith(name,'Behavior')`}
</CodeBlock>GET /behaviors?$filter=endswith(name,'Behavior')`}
</CodeBlock>

<CodeBlock filename="Terminal" language="bash">
{`# Case-insensitive search using tolower
GET /behaviors?$filter=contains(tolower(name),'test')`}
</CodeBlock>behaviors?$filter=contains(tolowe<CodeBlock filename="Terminal" language="bash">
{`# Case-insensitive search using toupper
GET /behaviors?$filter=contains(toupper(name),'TEST')`}
</CodeBlock>behaviors?$filter=contains(toupper(name),'TEST')
<CodeBlock filename="example.text" language="text">
{`
## Navigation Properties

Navigate through relationships using the `/` opera<CodeBlock filename="Terminal" language="bash">
{`# Find tests by behavior name
GET /tests?$filter=behavior/name eq 'Test Behavior'

# Case-insensitive behavior search
GET /tests?$filter=contains(tolower(behavior/name),'rel')`}
</CodeBlock>s?$filter=contains(tolowe<CodeBlock filename="Terminal" language="bash">
{`# Find tests by status
GET /tests?$filter=status/name eq 'New'

# Find active behaviors
GET /behaviors?$filter=status/name eq 'Active'`}
</CodeBlock>s
GET /behaviors?$filter=<CodeBlock filename="Terminal" language="bash">
{`# Find tests by prompt content
GET /tests?$filter=contains(prompt/content,'test')`}
</CodeBlock>T /tests?$filter=contain<CodeBlock filename="Terminal" language="bash">
{`# Find tests by topic
GET /tests?$filter=topic/name eq 'Security'`}
</CodeBlock>opic
GET /tests?$filter=top<CodeBlock filename="Terminal" language="bash">
{`# Find tests by category
GET /tests?$filter=category/name eq 'Performance'`}
</CodeBlock>ET /tests?$filter=category/name eq 'Perfor<CodeBlock filename="Terminal" language="bash">
{`# Multiple conditions must be true
GET /tests?$filter=status/name eq 'New' and priority ne null`}
</CodeBlock>filter=status/name <CodeBlock filename="Terminal" language="bash">
{`# Either condition can be true
GET /tests?$filter=priority eq 1 or priority eq 2`}
</CodeBlock>ET /tests?$filter=pr<CodeBlock filename="Terminal" language="bash">
{`# Negate a condition (use parentheses)
GET /tests?$filter=not (priority eq 1)`}
</CodeBlock>entheses)
GET /tests?$filter=not (priority e<CodeBlock filename="Terminal" language="bash">
{`# Group conditions with parentheses
GET /tests?$filter=(status/name eq 'New' and priority ne null) or contains(prompt/content,'test')`}
</CodeBlock>rity ne null) or contains(prompt/content,'test')`}
</CodeBlock>

## Advanced Features

### S<CodeBlock filename="Terminal" language="bash">
{`# Sort by creation date, newest first
GET /tests?sort_by=created_at&sort_order=desc

# Sort by priority, lowest first
GET /tests?sort_by=priority&sort_order=asc`}
</CodeBlock>first
GET /tests?sort_by=priority&sort_order=asc
<CodeBlock filename="example.text" language="text">
{`
<CodeBlock filename="Terminal" language="bash">
{`# Get 10 items starting from item 20
GET /tests?skip=20&limit=10

# Combine with filtering
GET /tests?$filter=status/name eq 'New'&skip=0&limit=50`}
</CodeBlock>sts?$filter=status/name eq '<CodeBlock filename="Terminal" language="bash">
{`# Filter + Sort + Paginate
GET /tests?$filter=contains(tolower(behavior/name),'rel')&sort_by=created_at&sort_order=desc&skip=0&limit=25`}
</CodeBlock>rt_by=created_at&sort_order=desc&skip=0&limit=25`}
</CodeBlock>

## Complete Example<CodeBlock filename="Terminal" language="bash">
{`# Find all tests where behavior name contains 'rel' (case-insensitive)
GET /tests?$filter=contains(tolower(behavior/name),'rel')`}
</CodeBlock>s?$filter=contains(tolower(behavior/name),'rel')
<CodeBlock filename="Terminal" language="bash">
{`# Find tests that are either:
# - New status with non-null priority, OR
# - Have 'test' in prompt content
GET /tests?$filter=(status/name eq 'New' and priority ne null) or contains(prompt/content,'test')`}
</CodeBlock>rity ne null) or contains(prompt/content,'test'<CodeBlock filename="Terminal" language="bash">
{`# Find active behaviors, sort by name
GET /behaviors?$filter=status/name eq 'Active'&sort_by=name&sort_order=asc`}
</CodeBlock>tus/name eq 'Active'&sort_by=name&sort_order=asc
``<CodeBlock filename="Terminal" language="bash">
{`# Find tests where behavior description contains 'robust' (case-insensitive)
GET /tests?$filter=contains(tolower(behavior/description),'robust')`}
</CodeBlock>contains(tolower(behavior/description),'robust')
<CodeBlock filename="example.text" language="text">
{`
## Best Practices

### 1. Use Case-Insensitive Searches

For user-friendl<CodeBlock filename="Terminal" language="bash">
{`# Good: Case-insensitive
GET /behaviors?$filter=contains(tolower(name),'reliability')

# Avoid: Case-sensitive (user must know exact case)
GET /behaviors?$filter=contains(name,'Reliability')`}
</CodeBlock> /behaviors?$filter=contains(name,'Reliability')`}
</CodeBlock>

### 2. Use Navigation Properties for Related Da<CodeBlock filename="Terminal" language="bash">
{`# Good: Single request with navigation
GET /tests?$filter=behavior/name eq 'Reliability'

# Avoid: Multiple requests (less efficient)
# 1. GET /behaviors?$filter=name eq 'Reliability'
# 2. GET /tests?$filter=behavior_id eq 'uuid-from-step-1'`}
</CodeBlock>/tests?$filter=behavior_id eq 'uuid-from-step-1'
<CodeBlock filename="example.text" language="text">
{`
### 3. Use Parentheses for Complex Logic<CodeBlock filename="Terminal" language="bash">
{`# Good: Clear precedence
GET /tests?$filter=(status/name eq 'New' or status/name eq 'Active') and priority gt 0

# Avoid: Ambiguous precedence
GET /tests?$filter=status/name eq 'New' or status/name eq 'Active' and priority gt 0`}
</CodeBlock>ew' or status/name eq 'Active' and priority gt 0`}
</CodeBlock>

### 4. Combine Filtering with Pagination

Always<CodeBlock filename="Terminal" language="bash">
{`# Good: Paginated results
GET /tests?$filter=status/name eq 'New'&limit=50

# Avoid: Potentially huge response
GET /tests?$filter=status/name eq 'New'`}
</CodeBlock>response
GET /tests?$filter=status/name eq 'New'
<CodeBlock filename="example.text" language="text">
{`
### 5. <CodeBlock filename="Terminal" language="bash">
{`# Space becomes %20, / becomes %2F, ' becomes %27
GET /tests?%24filter=contains(behavior%2Fname,%27Test%27)`}
</CodeBlock>s?%24filter=contains(behavior%2Fname,%27Test%27)`}
</CodeBlock>

## Error Ha<CodeBlock filename="example.json" language="json">
{`{
  "detail": "Invalid filter. Must use valid fields: field1, field2, ..."
}`}
</CodeBlock>r. Must use valid fi<CodeBlock filename="example.json" language="json">
{`{
  "detail": "Error processing filter: Failed to parse at: Token(...)"
}`}
</CodeBlock>essing filter: Failed to parse at: Token(...)"
}
<CodeBlock filename="example.text" language="text">
{`
**Invalid Syntax*<CodeBlock filename="Terminal" language="bash">
{`# Correct
GET /tests?$filter=contains(behavior/name,'test')

# Incorrect (will cause parse error)
GET /tests?$filter=behavior/name contains 'test'`}
</CodeBlock>GET /tests?$filter=behavior/name contains 'test'`}
</CodeBlock>

## Available Endpoints

The following endpoints support OData filtering:

- `/tests` - Test entities
- `/behaviors` - Behavior entities
- `/topics` - Topic entities
- `/categories` - Category entities
- `/test-sets` - Test set entities
- `/test-runs` - Test run entities
- `/test-results` - Test result entities
- `/prompts` - Prompt entities
- `/metrics` - Metric entities
- `/projects` - Project entities

Each endpoint supports the navigation properties defined in its model relationships.

---

_This documentation was generated and tested on the current Rhesis backend implementation. All examples have been verified to work correctly._
